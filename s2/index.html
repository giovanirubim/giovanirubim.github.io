<html>
	<head>
		<title></title>
		<meta name='viewport'
			content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
		<style type="text/css">
			body {
				margin: 0px;
				overflow: hidden;
				background-color: #222;
			}
		</style>
	</head>
	<body>
		<canvas width="512" height="512"></canvas>
	</body>
</html>
<script type="text/javascript">

	var canvas = document.querySelector("canvas");
	var ctx = canvas.getContext("2d");

	// function colorToArray(color) {
	// 	// Tenta converter alguns formatos do par√¢metro color para um vetor rgba
	// 	if (typeof color === "string") {
	// 		color = color.trim().toLowerCase();
	// 		var temp = "";
	// 		for (var i=0; i<color.length; ++i) {
	// 			color[i]!=' ' ? temp += color[i] : 0;
	// 		}
	// 		color = temp;
	// 		var result = [127, 127, 127, 1];
	// 		if (color[0] === '#') {
	// 			color = color.substr(1);
	// 			if (color.length === 3) {
	// 				for (var i=0; i<3; ++i) {
	// 					var temp = color[i];
	// 					result[i] = parseInt(temp + temp, 16);
	// 				}
	// 			} else if (color.length === 6) {
	// 				for (var i=0; i<3; ++i) {
	// 					var temp = color[i*2] + color[i*2 + 1];
	// 					result[i] = parseInt(temp, 16);
	// 				}
	// 			}
	// 		} else if (color.substr(0, 4) === "rgba") {
	// 			color = color.split("(");
	// 			if (color.length !== 2) return result;
	// 			color = color[1].replace(")", "").split(",");
	// 			if (color.length !== 4) return result;
	// 			for (var i=0; i<4; ++i) {
	// 				if (i < 3) {
	// 					result[i] = parseInt(color[i]);
	// 				} else {
	// 					result[i] = parseFloat(color[i]);
	// 				}
	// 			}
	// 		} else if (color.substr(0, 3) === "rgb") {
	// 			color = color.split("(");
	// 			if (color.length !== 2) return result;
	// 			color = color[1].replace(")", "").split(",");
	// 			if (color.length !== 3) return result;
	// 			for (var i=0; i<3; ++i) {
	// 				result[i] = parseInt(color[i]);
	// 			}
	// 		}
	// 		return result;
	// 	}
	// 	if (color instanceof Array) {
	// 		if (color.length === 3) {
	// 			color[3] = 1;
	// 		}
	// 		if (color.length === 4) {
	// 			return color;
	// 		}
	// 		return [127, 127, 127, 1];
	// 	}
	// }

	function ClockDrawer(properties) {
		this.nArcs = 4;
		this.colorStart = Array(4).fill([55,77,99,1]);
		this.colorEnd   = Array(4).fill([255,99,50,1]);
		this.progress    = [1/7, 2/7, 3/7, 4/7];
		this.text        = "??????".split("");
		this.margin      = 32;
		this.padding     = 20;
		this.innerRadius = 64;
	}

	ClockDrawer.prototype.draw = function(ctx, x, y, size) {
		var n = this.nArcs;
		var minRad = this.innerRadius;
		var maxRad = size*0.5 - this.margin;
		ctx.lineCap = "butt";
		var width = (maxRad - minRad - this.padding*(n - 1))/n;
		ctx.lineWidth = width;
		var progress = this.progress;
		ctx.fillStyle = "#fff";
		var fontSize = width*0.5;
		ctx.font = fontSize + "px monospace";
		ctx.textAlign = "right";
		ctx.textBaseline = "middle";
		for (var i=n-1; i>=0; --i) {
			var rad = minRad + (width + this.padding)*i + width*0.5;
			var arcIni = 1.5*Math.PI;
			var arcEnd = arcIni + progress[i]*Math.PI*2;
			var color = [0, 0, 0, 0];
			var weight = progress[i];
			for (var j=0; j<4; ++j) {
				color[j] += this.colorStart[i][j]*weight;
				color[j] += this.colorEnd[i][j]*(1-weight);
				if (j < 3) {
					color[j] = Math.round(color[j]);
				}
			}
			color = "rgba(" + color.join(",") + ")";
			ctx.strokeStyle = color;
			ctx.beginPath();
			ctx.arc(x, y, rad, arcIni, arcEnd);
			ctx.stroke();
			ctx.closePath();
			ctx.fillText(this.text[i], x - fontSize*0.5, y - rad);
		}
	};

	var drawer = new ClockDrawer();
	var sx = null;
	var sy = null;
	var target = new Date(2019,0,10,20,0);
	var timeZoneFix = (target.getTimezoneOffset() - 120);
	target.setMinutes(target.getMinutes() + timeZoneFix);

	function updateProgress() {
		var now = new Date();
		var t = 1;

		t *= 60000;
		var ms = (target.getTime() - now.getTime())%t;
		var pms = ms/t;
		drawer.progress[0] = pms;
		drawer.text[0] = Math.floor(pms*60) + " seg";
		now.setTime(now.getTime() + ms);
		
		t *= 60;
		var min = (target - now)%t;
		var pmin = min/t + pms/60;
		drawer.progress[1] = pmin;
		drawer.text[1] = Math.floor(pmin*60) + " min";
		now.setTime(now.getTime() + min);
		
		t *= 24;
		var hr = (target - now)%t;
		var phr = hr/t + pmin/24;
		drawer.progress[2] = phr;
		drawer.text[2] = Math.floor(phr*24) + " hr";
		now.setTime(now.getTime() + hr);

		var temp = new Date(now);
		temp.setMonth(temp.getMonth()+1);
		var nDays = (temp - now)/(1000*60*60*24);
	
		t *= nDays;
		var d = (target - now)%t;
		var pd = d/t + phr/nDays;
		drawer.progress[2] = pd;
		drawer.text[3] = Math.floor(pd*nDays) + " d";
	}

	function updateCanvas() {
		var newSx = window.innerWidth;
		var newSy = window.innerHeight;
		if (newSx !== sx || newSy !== sy) {
			sx = newSx;
			sy = newSy;
			canvas.setAttribute("width", sx);
			canvas.setAttribute("height", sy);
		}
		ctx.clearRect(0, 0, sx, sy);
		var size = Math.min(sx, sy);
		drawer.padding = size*0.04;
		drawer.innerRadius = size*0.07;
		drawer.margin = size*0.07;
		updateProgress();
		drawer.draw(ctx, sx/2, sy/2, size);
	}

	setInterval(updateCanvas, 0);

</script>